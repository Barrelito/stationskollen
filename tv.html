<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stationsvy - AISAB TV</title>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        body { 
            background-color: #020617; /* Ännu mörkare för bättre kontrast */
            color: #f8fafc;
            font-family: ui-sans-serif, system-ui, -apple-system, sans-serif;
            overflow: hidden; 
            padding: 30px;
        }
        .tv-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr); 
            gap: 20px;
            height: calc(100vh - 180px);
        }
        .day-card {
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid #1e293b;
            border-radius: 20px;
            padding: 24px;
            display: flex;
            flex-direction: column;
        }
        .task-row {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid #1e293b;
        }
        .task-row.done { opacity: 0.3; }
        .checkbox-tv {
            width: 34px; height: 34px;
            border-radius: 8px;
            border: 3px solid #facc15;
            display: flex; align-items: center; justify-content: center;
            flex-shrink: 0; margin-top: 4px;
        }
        .checkbox-tv.checked { background: #22c55e; border-color: #22c55e; }
        
        /* TEXTSTORLEKAR FÖR TV */
        .task-text { 
            font-size: 22px; /* Rejält uppskalad text */
            font-weight: 600; 
            line-height: 1.3; 
        }
        .day-title {
            font-size: 32px; /* Mycket tydliga dagar */
            font-weight: 800;
            color: #facc15;
        }
        .signer { font-size: 16px; color: #94a3b8; margin-top: 4px; }
        
        .header-tv { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
        
        .missed-alert {
            background: #be123c;
            color: white;
            padding: 15px 30px;
            border-radius: 15px;
            font-weight: 900;
            font-size: 24px;
            box-shadow: 0 0 30px rgba(190, 18, 60, 0.4);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const CONFIG = {
            apiKey: "AIzaSyB8aujVryb93dqWxnQk2z3OOvgHQi5XY9A",
            authDomain: "stationssyor.firebaseapp.com",
            projectId: "stationssyor",
            storageBucket: "stationssyor.firebasestorage.app",
            messagingSenderId: "628579465876",
            appId: "1:628579465876:web:dc868450ef2e13e8b1d281"
        };

        if (!firebase.apps.length) firebase.initializeApp(CONFIG);
        const db = firebase.firestore();
        const auth = firebase.auth();

        function getISOWeek() {
            const d = new Date();
            d.setHours(0, 0, 0, 0);
            d.setDate(d.getDate() + 4 - (d.getDay() || 7));
            return Math.ceil((((d - new Date(d.getFullYear(), 0, 1)) / 86400000) + 1) / 7);
        }

        function StationTV() {
            const [tasks, setTasks] = useState([]);
            const [missed, setMissed] = useState([]);

            useEffect(() => {
                auth.signInAnonymously().then(() => {
                    db.collection('artifacts').doc('station-app')
                      .collection('public').doc('data').collection('chores').doc('current_state')
                      .onSnapshot(snapshot => {
                          if (snapshot.exists) {
                              const data = snapshot.data();
                              setTasks(data.tasks || []);
                              setMissed(data.missedTasks || []);
                          }
                      });
                });
            }, []);

            const tasksByDay = tasks.reduce((acc, task) => {
                if (task.isAdHoc) return acc;
                if (!acc[task.day]) acc[task.day] = [];
                acc[task.day].push(task);
                return acc;
            }, {});

            const days = ['Måndag', 'Tisdag', 'Onsdag', 'Torsdag', 'Fredag'];

            return (
                <div>
                    <div className="header-tv">
                        <div className="flex items-center gap-6">
                            <div className="bg-yellow-400 p-4 rounded-2xl text-slate-950 font-black text-4xl">AISAB</div>
                            <div>
                                <h1 className="text-6xl font-black tracking-tighter italic">STATIONSSYSSLOR</h1>
                                <p className="text-yellow-400 font-bold text-2xl tracking-widest uppercase">Vecka {getISOWeek()}</p>
                            </div>
                        </div>

                        <div className="flex gap-8 items-center">
                            {missed.filter(t => !t.done).length > 0 && (
                                <div className="missed-alert animate-bounce">
                                    {missed.filter(t => !t.done).length} SLÄPANDE
                                </div>
                            )}
                            <div className="text-right border-l-4 border-slate-800 pl-8">
                                <div className="text-6xl font-black leading-none">{new Date().toLocaleTimeString('sv-SE', {hour: '2-digit', minute:'2-digit'})}</div>
                                <div className="text-slate-500 text-xl font-bold uppercase mt-2">{new Date().toLocaleDateString('sv-SE', {weekday: 'long', day: 'numeric', month: 'short'})}</div>
                            </div>
                        </div>
                    </div>

                    <div className="tv-grid">
                        {days.map(day => (
                            <div key={day} className="day-card">
                                <div className="flex justify-between items-end mb-6 border-b-4 border-yellow-500/20 pb-4">
                                    <h2 className="day-title">{day}</h2>
                                    <span className="text-xl font-black bg-slate-800 px-3 py-1 rounded-lg text-slate-400">
                                        {tasksByDay[day]?.filter(t=>t.done).length || 0}/{tasksByDay[day]?.length || 0}
                                    </span>
                                </div>
                                <div className="space-y-2">
                                    {tasksByDay[day]?.map(task => (
                                        <div key={task.id} className={`task-row ${task.done ? 'done' : ''}`}>
                                            <div className={`checkbox-tv ${task.done ? 'checked' : ''}`}>
                                                {task.done && <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="4"><polyline points="20 6 9 17 4 12" /></svg>}
                                            </div>
                                            <div>
                                                <div className="task-text">{task.text}</div>
                                                {task.signedBy && <div className="signer">Sign: {task.signedBy}</div>}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<StationTV />);
    </script>
</body>
</html>
